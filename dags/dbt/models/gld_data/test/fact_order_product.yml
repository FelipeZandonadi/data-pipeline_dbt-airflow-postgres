version: 2

models:
  - name: fact_order_product
    description: "Tabela de fatos de pedidos e produtos"
    columns:
      - name: id_order_product_sk
        description: "Chave primária de pedidos e produtos"
        tests:
          - not_null
          - unique


      - name: id_order
        description: "Relacionamento com os pedidos"
        tests:
          - not_null

      - name: id_product
        description: "Relacionamento com os produtos"
        tests:
          - not_null
          - relationships:
              to: ref('dim_product')
              field: id_product
      
      - name: id_seller
        description: "Relacionamento com os vendedores"
        tests:
          - not_null

      - name: key_order_approved_at
        description: "Data de aprovação do pedido"
        tests:
          - relationships:
              to: ref('dim_date')
              field: id_date_sk

      - name: key_order_delivered_customer_date
        description: "Data de entrega do pedido"
        tests:
          - relationships:
              to: ref('dim_date')
              field: id_date_sk
      
      - name: key_order_estimated_delivery_date
        description: "Data estimada de entrega do pedido"
        tests:
          - relationships:
              to: ref('dim_date')
              field: id_date_sk
      
      - name: key_state_city
        description: "Localização do pedido"
        tests:
          - not_null
          - relationships:
              to: ref('dim_location')
              field: id_state_city_sk

      - name: order_status
        description: "Status do pedido"
        tests:
          - not_null
          - accepted_values:
              values: ['shipped', 'unavailable', 'invoiced', 'created', 'approved', 'processing', 'delivered', 'canceled', 'returned',]

      - name: qty_item
        description: "Quantidade de itens"
        tests:
          - not_null

      - name: price_item
        description: "Preço do item"
        tests:
          - not_null

      - name: order_amount_payment_installments
        description: "Valor total de parcelas do pedido"
        tests:
          - not_null

    tests:
      - column_pattern_field:
          column: 'id_order_product_sk'
          pattern: '%-%'
      - column_pattern_field:
          column: 'key_state_city'
          pattern: '__-%'
